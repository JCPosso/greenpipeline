name: CI with GreenPipeline

on: [push, pull_request]
permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  test-with-carbon-measurement:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # INICIO DE MEDICIÃ“N
      - name: Start GreenPipeline
        uses: ./.github/actions/greenpipeline
        with:
          mode: start
          location: CO # Colombia

      # TUS STEPS NORMALES
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm install
        working-directory: ./dashboard

      - name: Run tests
        run: npm test
        working-directory: ./dashboard

      - name: Build
        run: npm run build
        working-directory: ./dashboard

      #  REPORTE FINAL
      - name: GreenPipeline Report
        uses: ./.github/actions/greenpipeline
        with:
          mode: report
          location: CO
          comment-pr: true
          fail-on-threshold: 1.0 # Fallar si > 1g CO2e
